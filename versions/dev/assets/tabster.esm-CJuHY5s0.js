var e="undefined"!=typeof WeakRef,t=class{constructor(t){e&&"object"==typeof t?this._weakRef=new WeakRef(t):this._instance=t}deref(){var e,t;let s;return this._weakRef?(s=null==(e=this._weakRef)?void 0:e.deref(),s||delete this._weakRef):(s=this._instance,(null==(t=null==s?void 0:s.isDisposed)?void 0:t.call(s))&&delete this._instance),s}},s="keyborg:focusin",i="keyborg:focusout",o=!1;function n(e){const t=e.focus;t.__keyborgNativeFocus?t.__keyborgNativeFocus.call(e):e.focus()}var r=0,l=class{constructor(e,n){this._isNavigatingWithKeyboard_DO_NOT_USE=!1,this._onFocusIn=e=>{if(this._isMouseOrTouchUsedTimer)return;if(this.isNavigatingWithKeyboard)return;const t=e.detail;t.relatedTarget&&(t.isFocusedProgrammatically||void 0===t.isFocusedProgrammatically||(this.isNavigatingWithKeyboard=!0))},this._onMouseDown=e=>{0===e.buttons||0===e.clientX&&0===e.clientY&&0===e.screenX&&0===e.screenY||this._onMouseOrTouch()},this._onMouseOrTouch=()=>{const e=this._win;e&&(this._isMouseOrTouchUsedTimer&&e.clearTimeout(this._isMouseOrTouchUsedTimer),this._isMouseOrTouchUsedTimer=e.setTimeout((()=>{delete this._isMouseOrTouchUsedTimer}),1e3)),this.isNavigatingWithKeyboard=!1},this._onKeyDown=e=>{this.isNavigatingWithKeyboard?this._shouldDismissKeyboardNavigation(e)&&this._scheduleDismiss():this._shouldTriggerKeyboardNavigation(e)&&(this.isNavigatingWithKeyboard=!0)},this.id="c"+ ++r,this._win=e;const l=e.document;if(n){const e=n.triggerKeys,t=n.dismissKeys;(null==e?void 0:e.length)&&(this._triggerKeys=new Set(e)),(null==t?void 0:t.length)&&(this._dismissKeys=new Set(t))}l.addEventListener(s,this._onFocusIn,!0),l.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("keydown",this._onKeyDown,!0),l.addEventListener("touchstart",this._onMouseOrTouch,!0),l.addEventListener("touchend",this._onMouseOrTouch,!0),l.addEventListener("touchcancel",this._onMouseOrTouch,!0),function(e){const n=e;o||(o=function(e){const t=e.HTMLElement,s=t.prototype.focus;let i=!1;return t.prototype.focus=function(){i=!0},e.document.createElement("button").focus(),t.prototype.focus=s,i}(n));const r=n.HTMLElement.prototype.focus;if(r.__keyborgNativeFocus)return;n.HTMLElement.prototype.focus=h;const l=new Set,a=e=>{const t=e.target;if(!t)return;const s=new CustomEvent(i,{cancelable:!0,bubbles:!0,composed:!0,detail:{originalEvent:e}});t.dispatchEvent(s)},u=e=>{const t=e.target;if(!t)return;let s=e.composedPath()[0];const i=new Set;for(;s;)s.nodeType===Node.DOCUMENT_FRAGMENT_NODE?(i.add(s),s=s.host):s=s.parentNode;for(const o of l){const e=o.deref();e&&i.has(e)||(l.delete(o),e&&(e.removeEventListener("focusin",u,!0),e.removeEventListener("focusout",a,!0)))}c(t,e.relatedTarget||void 0)},c=(e,i,n)=>{var r;const c=e.shadowRoot;if(c){for(const e of l)if(e.deref()===c)return;return c.addEventListener("focusin",u,!0),c.addEventListener("focusout",a,!0),void l.add(new t(c))}const h={relatedTarget:i,originalEvent:n},_=new CustomEvent(s,{cancelable:!0,bubbles:!0,composed:!0,detail:h});_.details=h,(o||d.lastFocusedProgrammatically)&&(h.isFocusedProgrammatically=e===(null==(r=d.lastFocusedProgrammatically)?void 0:r.deref()),d.lastFocusedProgrammatically=void 0),e.dispatchEvent(_)},d=n.__keyborgData={focusInHandler:u,focusOutHandler:a,shadowTargets:l};function h(){const e=n.__keyborgData;return e&&(e.lastFocusedProgrammatically=new t(this)),r.apply(this,arguments)}n.document.addEventListener("focusin",n.__keyborgData.focusInHandler,!0),n.document.addEventListener("focusout",n.__keyborgData.focusOutHandler,!0);let _=n.document.activeElement;for(;_&&_.shadowRoot;)c(_),_=_.shadowRoot.activeElement;h.__keyborgNativeFocus=r}(e)}get isNavigatingWithKeyboard(){return this._isNavigatingWithKeyboard_DO_NOT_USE}set isNavigatingWithKeyboard(e){this._isNavigatingWithKeyboard_DO_NOT_USE!==e&&(this._isNavigatingWithKeyboard_DO_NOT_USE=e,this.update())}dispose(){const e=this._win;if(e){this._isMouseOrTouchUsedTimer&&(e.clearTimeout(this._isMouseOrTouchUsedTimer),this._isMouseOrTouchUsedTimer=void 0),this._dismissTimer&&(e.clearTimeout(this._dismissTimer),this._dismissTimer=void 0),function(e){const t=e,s=t.HTMLElement.prototype,i=s.focus.__keyborgNativeFocus,o=t.__keyborgData;if(o){t.document.removeEventListener("focusin",o.focusInHandler,!0),t.document.removeEventListener("focusout",o.focusOutHandler,!0);for(const e of o.shadowTargets){const t=e.deref();t&&(t.removeEventListener("focusin",o.focusInHandler,!0),t.removeEventListener("focusout",o.focusOutHandler,!0))}o.shadowTargets.clear(),delete t.__keyborgData}i&&(s.focus=i)}(e);const t=e.document;t.removeEventListener(s,this._onFocusIn,!0),t.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("keydown",this._onKeyDown,!0),t.removeEventListener("touchstart",this._onMouseOrTouch,!0),t.removeEventListener("touchend",this._onMouseOrTouch,!0),t.removeEventListener("touchcancel",this._onMouseOrTouch,!0),delete this._win}}isDisposed(){return!!this._win}update(){var e,t;const s=null==(t=null==(e=this._win)?void 0:e.__keyborg)?void 0:t.refs;if(s)for(const i of Object.keys(s))a.update(s[i],this.isNavigatingWithKeyboard)}_shouldTriggerKeyboardNavigation(e){var t;if("Tab"===e.key)return!0;const s=null==(t=this._win)?void 0:t.document.activeElement,i=!this._triggerKeys||this._triggerKeys.has(e.keyCode),o=s&&("INPUT"===s.tagName||"TEXTAREA"===s.tagName||s.isContentEditable);return i&&!o}_shouldDismissKeyboardNavigation(e){var t;return null==(t=this._dismissKeys)?void 0:t.has(e.keyCode)}_scheduleDismiss(){const e=this._win;if(e){this._dismissTimer&&(e.clearTimeout(this._dismissTimer),this._dismissTimer=void 0);const t=e.document.activeElement;this._dismissTimer=e.setTimeout((()=>{this._dismissTimer=void 0;const s=e.document.activeElement;t&&s&&t===s&&(this.isNavigatingWithKeyboard=!1)}),500)}}},a=class e{constructor(e,t){this._cb=[],this._id="k"+ ++r,this._win=e;const s=e.__keyborg;s?(this._core=s.core,s.refs[this._id]=this):(this._core=new l(e,t),e.__keyborg={core:this._core,refs:{[this._id]:this}})}static create(t,s){return new e(t,s)}static dispose(e){e.dispose()}static update(e,t){e._cb.forEach((e=>e(t)))}dispose(){var e;const t=null==(e=this._win)?void 0:e.__keyborg;(null==t?void 0:t.refs[this._id])&&(delete t.refs[this._id],0===Object.keys(t.refs).length&&(t.core.dispose(),delete this._win.__keyborg)),this._cb=[],delete this._core,delete this._win}isNavigatingWithKeyboard(){var e;return!!(null==(e=this._core)?void 0:e.isNavigatingWithKeyboard)}subscribe(e){this._cb.push(e)}unsubscribe(e){const t=this._cb.indexOf(e);t>=0&&this._cb.splice(t,1)}setVal(e){this._core&&(this._core.isNavigatingWithKeyboard=e)}};
/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */
/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */
const u="data-tabster",c="data-tabster-dummy",d=["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","*[tabindex]","*[contenteditable]","details > summary","audio[controls]","video[controls]"].join(", "),h={EscapeGroupper:1,Restorer:2,Deloser:3},_={History:0,DeloserDefault:1,RootDefault:2,DeloserFirst:3,RootFirst:4},m={Auto:0,Manual:1},f={Invisible:0,PartiallyVisible:1,Visible:2},v={Both:0,Vertical:1,Horizontal:2,Grid:3,GridLinear:4},b={ArrowUp:1,ArrowDown:2,ArrowLeft:3,ArrowRight:4,PageUp:5,PageDown:6,Home:7,End:8},g={Outside:2};
/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */
function p(e,t){var s;return null===(s=e.storageEntry(t))||void 0===s?void 0:s.tabster}function y(e,t,s){var i,o;const n=s||e._noop?void 0:t.getAttribute(u);let r,l=e.storageEntry(t);if(n){if(n===(null===(i=null==l?void 0:l.attr)||void 0===i?void 0:i.string))return;try{const e=JSON.parse(n);if("object"!=typeof e)throw new Error(`Value is not a JSON object, got '${n}'.`);r={string:n,object:e}}catch(h){}}else if(!l)return;l||(l=e.storageEntry(t,!0)),l.tabster||(l.tabster={});const a=l.tabster||{},c=(null===(o=l.attr)||void 0===o?void 0:o.object)||{},d=(null==r?void 0:r.object)||{};for(const u of Object.keys(c))if(!d[u]){if("root"===u){const t=a[u];t&&e.root.onRoot(t,!0)}switch(u){case"deloser":case"root":case"groupper":case"modalizer":case"restorer":case"mover":const s=a[u];s&&(s.dispose(),delete a[u]);break;case"observed":delete a[u],e.observedElement&&e.observedElement.onObservedElementUpdate(t);break;case"focusable":case"outline":case"uncontrolled":case"sys":delete a[u]}}for(const u of Object.keys(d)){const s=d.sys;switch(u){case"deloser":a.deloser?a.deloser.setProps(d.deloser):e.deloser&&(a.deloser=e.deloser.createDeloser(t,d.deloser));break;case"root":a.root?a.root.setProps(d.root):a.root=e.root.createRoot(t,d.root,s),e.root.onRoot(a.root);break;case"modalizer":a.modalizer?a.modalizer.setProps(d.modalizer):e.modalizer&&(a.modalizer=e.modalizer.createModalizer(t,d.modalizer,s));break;case"restorer":a.restorer?a.restorer.setProps(d.restorer):e.restorer&&d.restorer&&(a.restorer=e.restorer.createRestorer(t,d.restorer));break;case"focusable":a.focusable=d.focusable;break;case"groupper":a.groupper?a.groupper.setProps(d.groupper):e.groupper&&(a.groupper=e.groupper.createGroupper(t,d.groupper,s));break;case"mover":a.mover?a.mover.setProps(d.mover):e.mover&&(a.mover=e.mover.createMover(t,d.mover,s));break;case"observed":e.observedElement&&(a.observed=d.observed,e.observedElement.onObservedElementUpdate(t));break;case"uncontrolled":a.uncontrolled=d.uncontrolled;break;case"outline":e.outline&&(a.outline=d.outline);break;case"sys":a.sys=d.sys;break;default:console.error(`Unknown key '${u}' in data-tabster attribute value.`)}}r?l.attr=r:(0===Object.keys(a).length&&(delete l.tabster,delete l.attr),e.storageEntry(t,!1))}
/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */const E="tabster:focusin",T="tabster:focusout",w="tabster:movefocus",F="tabster:deloser:focus-lost",D="tabster:deloser:restore-focus",C="tabster:mover:state",I="tabster:mover:movefocus",k="tabster:mover:memorized-element",O="tabster:root:focus",R="tabster:root:blur",N="undefined"!=typeof CustomEvent?CustomEvent:function(){};class M extends N{constructor(e,t){super(e,{bubbles:!0,cancelable:!0,composed:!0,detail:t}),this.details=t}}class A extends M{constructor(e){super(E,e)}}class P extends M{constructor(e){super(T,e)}}class x extends M{constructor(e){super(w,e)}}class L extends M{constructor(e){super(C,e)}}class W extends M{constructor(e){super(F,e)}}class S extends M{constructor(e){super(O,e)}}class B extends M{constructor(e){super(R,e)}}
/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */const z={createMutationObserver:e=>new MutationObserver(e),createTreeWalker:(e,t,s,i)=>e.createTreeWalker(t,s,i),getParentNode:e=>e?e.parentNode:null,getParentElement:e=>e?e.parentElement:null,nodeContains:(e,t)=>!(!t||!(null==e?void 0:e.contains(t))),getActiveElement:e=>e.activeElement,querySelector:(e,t)=>e.querySelector(t),querySelectorAll:(e,t)=>Array.prototype.slice.call(e.querySelectorAll(t),0),getElementById:(e,t)=>e.getElementById(t),getFirstChild:e=>(null==e?void 0:e.firstChild)||null,getLastChild:e=>(null==e?void 0:e.lastChild)||null,getNextSibling:e=>(null==e?void 0:e.nextSibling)||null,getPreviousSibling:e=>(null==e?void 0:e.previousSibling)||null,getFirstElementChild:e=>(null==e?void 0:e.firstElementChild)||null,getLastElementChild:e=>(null==e?void 0:e.lastElementChild)||null,getNextElementSibling:e=>(null==e?void 0:e.nextElementSibling)||null,getPreviousElementSibling:e=>(null==e?void 0:e.previousElementSibling)||null,appendChild:(e,t)=>e.appendChild(t),insertBefore:(e,t,s)=>e.insertBefore(t,s),getSelection:e=>{var t;return(null===(t=e.ownerDocument)||void 0===t?void 0:t.getSelection())||null},getElementsByName:(e,t)=>e.ownerDocument.getElementsByName(t)};
/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */
let U;const K="undefined"!=typeof DOMRect?DOMRect:class{constructor(e,t,s,i){this.left=e||0,this.top=t||0,this.right=(e||0)+(s||0),this.bottom=(t||0)+(i||0)}};let V=0;try{document.createTreeWalker(document,NodeFilter.SHOW_ELEMENT),U=!1}catch(Ye){U=!0}function H(e){const t=e();let s=t.__tabsterInstanceContext;return s||(s={elementByUId:{},basics:{Promise:t.Promise||void 0,WeakRef:t.WeakRef||void 0},containerBoundingRectCache:{},lastContainerBoundingRectCacheId:0,fakeWeakRefs:[],fakeWeakRefsStarted:!1},t.__tabsterInstanceContext=s),s}class j{constructor(e){this._target=e}deref(){return this._target}static cleanup(e,t){return!e._target||!(!t&&se(e._target.ownerDocument,e._target))&&(delete e._target,!0)}}class Q{constructor(e,t,s){const i=H(e);let o;i.WeakRef?o=new i.WeakRef(t):(o=new j(t),i.fakeWeakRefs.push(o)),this._ref=o,this._data=s}get(){const e=this._ref;let t;return e&&(t=e.deref(),t||delete this._ref),t}getData(){return this._data}}function G(e,t){const s=H(e);s.fakeWeakRefs=s.fakeWeakRefs.filter((e=>!j.cleanup(e,t)))}function q(e){const t=H(e);t.fakeWeakRefsStarted||(t.fakeWeakRefsStarted=!0,t.WeakRef=function(e){return e.basics.WeakRef}(t)),t.fakeWeakRefsTimer||(t.fakeWeakRefsTimer=e().setTimeout((()=>{t.fakeWeakRefsTimer=void 0,G(e),q(e)}),12e4))}function J(e,t,s){if(t.nodeType!==Node.ELEMENT_NODE)return;const i=U?s:{acceptNode:s};return z.createTreeWalker(e,t,NodeFilter.SHOW_ELEMENT,i,!1)}function $(e,t){let s=t.__tabsterCacheId;const i=H(e),o=s?i.containerBoundingRectCache[s]:void 0;if(o)return o.rect;const n=t.ownerDocument&&t.ownerDocument.documentElement;if(!n)return new K;let r=0,l=0,a=n.clientWidth,u=n.clientHeight;if(t!==n){const e=t.getBoundingClientRect();r=Math.max(r,e.left),l=Math.max(l,e.top),a=Math.min(a,e.right),u=Math.min(u,e.bottom)}const c=new K(r<a?r:-1,l<u?l:-1,r<a?a-r:0,l<u?u-l:0);return s||(s="r-"+ ++i.lastContainerBoundingRectCacheId,t.__tabsterCacheId=s),i.containerBoundingRectCache[s]={rect:c,element:t},i.containerBoundingRectCacheTimer||(i.containerBoundingRectCacheTimer=window.setTimeout((()=>{i.containerBoundingRectCacheTimer=void 0;for(const e of Object.keys(i.containerBoundingRectCache))delete i.containerBoundingRectCache[e].element.__tabsterCacheId;i.containerBoundingRectCache={}}),50)),c}function X(e,t,s){const i=Y(t);if(!i)return!1;const o=$(e,i),n=t.getBoundingClientRect(),r=n.height*(1-s),l=Math.max(0,o.top-n.top)+Math.max(0,n.bottom-o.bottom);return 0===l||l<=r}function Y(e){const t=e.ownerDocument;if(t){for(let t=z.getParentElement(e);t;t=z.getParentElement(t))if(t.scrollWidth>t.clientWidth||t.scrollHeight>t.clientHeight)return t;return t.documentElement}return null}function Z(e){return!!e.__shouldIgnoreFocus}function ee(e,t){const s=H(e);let i=t.__tabsterElementUID;return i||(i=t.__tabsterElementUID=function(e){const t=new Uint32Array(4);if(e.crypto&&e.crypto.getRandomValues)e.crypto.getRandomValues(t);else if(e.msCrypto&&e.msCrypto.getRandomValues)e.msCrypto.getRandomValues(t);else for(let i=0;i<t.length;i++)t[i]=4294967295*Math.random();const s=[];for(let i=0;i<t.length;i++)s.push(t[i].toString(36));return s.push("|"),s.push((++V).toString(36)),s.push("|"),s.push(Date.now().toString(36)),s.join("")}(e())),!s.elementByUId[i]&&se(t.ownerDocument,t)&&(s.elementByUId[i]=new Q(e,t)),i}function te(e,t){const s=H(e);for(const i of Object.keys(s.elementByUId)){const e=s.elementByUId[i],o=e&&e.get();o&&t&&!z.nodeContains(t,o)||delete s.elementByUId[i]}}function se(e,t){return z.nodeContains(null==e?void 0:e.body,t)}function ie(e,t){const s=e.matches||e.matchesSelector||e.msMatchesSelector||e.webkitMatchesSelector;return s&&s.call(e,t)}function oe(e){const t=H(e);if(t.basics.Promise)return t.basics.Promise;throw new Error("No Promise defined.")}let ne=0;class re{constructor(e,t,s){const i=e.getWindow;this._tabster=e,this._element=new Q(i,t),this._props={...s},this.id="i"+ ++ne}getElement(){return this._element.get()}getProps(){return this._props}setProps(e){this._props={...e}}}class le{constructor(e,t,s,i,o){var r;this._focusIn=e=>{if(this._fixedTarget){const e=this._fixedTarget.get();return void(e&&n(e))}const t=this.input;if(this.onFocusIn&&t){const s=e.relatedTarget;this.onFocusIn(this,this._isBackward(!0,t,s),s)}},this._focusOut=e=>{if(this._fixedTarget)return;this.useDefaultAction=!1;const t=this.input;if(this.onFocusOut&&t){const s=e.relatedTarget;this.onFocusOut(this,this._isBackward(!1,t,s),s)}};const l=e(),a=l.document.createElement("i");a.tabIndex=0,a.setAttribute("role","none"),a.setAttribute(c,""),a.setAttribute("aria-hidden","true");const u=a.style;u.position="fixed",u.width=u.height="1px",u.opacity="0.001",u.zIndex="-1",u.setProperty("content-visibility","hidden"),function(e){e.__shouldIgnoreFocus=!0}(a),this.input=a,this.isFirst=s.isFirst,this.isOutside=t,this._isPhantom=null!==(r=s.isPhantom)&&void 0!==r&&r,this._fixedTarget=o,a.addEventListener("focusin",this._focusIn),a.addEventListener("focusout",this._focusOut),a.__tabsterDummyContainer=i,this._isPhantom&&(this._disposeTimer=l.setTimeout((()=>{delete this._disposeTimer,this.dispose()}),0),this._clearDisposeTimeout=()=>{this._disposeTimer&&(l.clearTimeout(this._disposeTimer),delete this._disposeTimer),delete this._clearDisposeTimeout})}dispose(){var e;this._clearDisposeTimeout&&this._clearDisposeTimeout();const t=this.input;t&&(delete this._fixedTarget,delete this.onFocusIn,delete this.onFocusOut,delete this.input,t.removeEventListener("focusin",this._focusIn),t.removeEventListener("focusout",this._focusOut),delete t.__tabsterDummyContainer,null===(e=z.getParentNode(t))||void 0===e||e.removeChild(t))}setTopLeft(e,t){var s;const i=null===(s=this.input)||void 0===s?void 0:s.style;i&&(i.top=`${e}px`,i.left=`${t}px`)}_isBackward(e,t,s){return e&&!s?!this.isFirst:!!(s&&t.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_FOLLOWING)}}class ae{constructor(e,t,s,i,o,n){this._element=t,this._instance=new ce(e,t,this,s,i,o,n)}_setHandlers(e,t){this._onFocusIn=e,this._onFocusOut=t}moveOut(e){var t;null===(t=this._instance)||void 0===t||t.moveOut(e)}moveOutWithDefaultAction(e,t){var s;null===(s=this._instance)||void 0===s||s.moveOutWithDefaultAction(e,t)}getHandler(e){return e?this._onFocusIn:this._onFocusOut}setTabbable(e){var t;null===(t=this._instance)||void 0===t||t.setTabbable(this,e)}dispose(){this._instance&&(this._instance.dispose(this),delete this._instance),delete this._onFocusIn,delete this._onFocusOut}static moveWithPhantomDummy(e,t,s,i,o){const r=new le(e.getWindow,!0,{isPhantom:!0,isFirst:!0}).input;if(r){let l,a;if("BODY"===t.tagName)l=t,a=s&&i||!s&&!i?z.getFirstElementChild(t):null;else{let o,n;s&&(!i||i&&!e.focusable.isFocusable(t,!1,!0,!0))?(l=t,a=i?t.firstElementChild:null):(l=z.getParentElement(t),a=s&&i||!s&&!i?t:z.getNextElementSibling(t));do{o=s&&i||!s&&!i?z.getPreviousElementSibling(a):a,n=me(o),n===t?a=s&&i||!s&&!i?o:z.getNextElementSibling(o):n=null}while(n)}(null==l?void 0:l.dispatchEvent(new x({by:"root",owner:l,next:null,relatedEvent:o})))&&(z.insertBefore(l,r,a),n(r))}}static addPhantomDummyWithTarget(e,t,s,i){const o=new le(e.getWindow,!0,{isPhantom:!0,isFirst:!0},void 0,new Q(e.getWindow,i)).input;if(o){let e,i;t.querySelector(d)&&!s?(e=t,i=z.getFirstElementChild(t)):(e=z.getParentElement(t),i=s?t:z.getNextElementSibling(t)),e&&z.insertBefore(e,o,i)}}}class ue{constructor(e){this._updateQueue=new Set,this._lastUpdateQueueTime=0,this._changedParents=new WeakSet,this._dummyElements=[],this._dummyCallbacks=new WeakMap,this._domChanged=e=>{var t;this._changedParents.has(e)||(this._changedParents.add(e),this._updateDummyInputsTimer||(this._updateDummyInputsTimer=null===(t=this._win)||void 0===t?void 0:t.call(this).setTimeout((()=>{delete this._updateDummyInputsTimer;for(const e of this._dummyElements){const t=e.get();if(t){const e=this._dummyCallbacks.get(t);if(e){const s=z.getParentNode(t);s&&!this._changedParents.has(s)||e()}}}this._changedParents=new WeakSet}),100)))},this._win=e}add(e,t){!this._dummyCallbacks.has(e)&&this._win&&(this._dummyElements.push(new Q(this._win,e)),this._dummyCallbacks.set(e,t),this.domChanged=this._domChanged)}remove(e){this._dummyElements=this._dummyElements.filter((t=>{const s=t.get();return s&&s!==e})),this._dummyCallbacks.delete(e),0===this._dummyElements.length&&delete this.domChanged}dispose(){var e;const t=null===(e=this._win)||void 0===e?void 0:e.call(this);this._updateTimer&&(null==t||t.clearTimeout(this._updateTimer),delete this._updateTimer),this._updateDummyInputsTimer&&(null==t||t.clearTimeout(this._updateDummyInputsTimer),delete this._updateDummyInputsTimer),this._changedParents=new WeakSet,this._dummyCallbacks=new WeakMap,this._dummyElements=[],this._updateQueue.clear(),delete this.domChanged,delete this._win}updatePositions(e){this._win&&(this._updateQueue.add(e),this._lastUpdateQueueTime=Date.now(),this._scheduledUpdatePositions())}_scheduledUpdatePositions(){var e;this._updateTimer||(this._updateTimer=null===(e=this._win)||void 0===e?void 0:e.call(this).setTimeout((()=>{if(delete this._updateTimer,this._lastUpdateQueueTime+100<=Date.now()){const e=new Map,t=[];for(const s of this._updateQueue)t.push(s(e));this._updateQueue.clear();for(const s of t)s();e.clear()}else this._scheduledUpdatePositions()}),100))}}class ce{constructor(e,t,s,i,o,r,l){this._wrappers=[],this._isOutside=!1,this._transformElements=new Set,this._onFocusIn=(e,t,s)=>{this._onFocus(!0,e,t,s)},this._onFocusOut=(e,t,s)=>{this._onFocus(!1,e,t,s)},this.moveOut=e=>{var t;const s=this._firstDummy,i=this._lastDummy;if(s&&i){this._ensurePosition();const o=s.input,r=i.input,l=null===(t=this._element)||void 0===t?void 0:t.get();if(o&&r&&l){let t;e?(o.tabIndex=0,t=o):(r.tabIndex=0,t=r),t&&n(t)}}},this.moveOutWithDefaultAction=(e,t)=>{var s;const i=this._firstDummy,o=this._lastDummy;if(i&&o){this._ensurePosition();const r=i.input,l=o.input,a=null===(s=this._element)||void 0===s?void 0:s.get();if(r&&l&&a){let s;e?!i.isOutside&&this._tabster.focusable.isFocusable(a,!0,!0,!0)?s=a:(i.useDefaultAction=!0,r.tabIndex=0,s=r):(o.useDefaultAction=!0,l.tabIndex=0,s=l),s&&a.dispatchEvent(new x({by:"root",owner:a,next:null,relatedEvent:t}))&&n(s)}}},this.setTabbable=(e,t)=>{var s,i;for(const n of this._wrappers)if(n.manager===e){n.tabbable=t;break}const o=this._getCurrent();if(o){const e=o.tabbable?0:-1;let t=null===(s=this._firstDummy)||void 0===s?void 0:s.input;t&&(t.tabIndex=e),t=null===(i=this._lastDummy)||void 0===i?void 0:i.input,t&&(t.tabIndex=e)}},this._addDummyInputs=()=>{this._addTimer||(this._addTimer=this._getWindow().setTimeout((()=>{delete this._addTimer,this._ensurePosition(),this._addTransformOffsets()}),0))},this._addTransformOffsets=()=>{this._tabster._dummyObserver.updatePositions(this._computeTransformOffsets)},this._computeTransformOffsets=e=>{var t,s;const i=(null===(t=this._firstDummy)||void 0===t?void 0:t.input)||(null===(s=this._lastDummy)||void 0===s?void 0:s.input),o=this._transformElements,n=new Set;let r=0,l=0;const a=this._getWindow();for(let u=i;u&&u.nodeType===Node.ELEMENT_NODE;u=z.getParentElement(u)){let t=e.get(u);if(void 0===t){const s=a.getComputedStyle(u).transform;s&&"none"!==s&&(t={scrollTop:u.scrollTop,scrollLeft:u.scrollLeft}),e.set(u,t||null)}t&&(n.add(u),o.has(u)||u.addEventListener("scroll",this._addTransformOffsets),r+=t.scrollTop,l+=t.scrollLeft)}for(const u of o)n.has(u)||u.removeEventListener("scroll",this._addTransformOffsets);return this._transformElements=n,()=>{var e,t;null===(e=this._firstDummy)||void 0===e||e.setTopLeft(r,l),null===(t=this._lastDummy)||void 0===t||t.setTopLeft(r,l)}};const a=t.get();if(!a)throw new Error("No element");this._tabster=e,this._getWindow=e.getWindow,this._callForDefaultAction=l;const u=a.__tabsterDummy;if((u||this)._wrappers.push({manager:s,priority:i,tabbable:!0}),u)return u;a.__tabsterDummy=this;const c=null==o?void 0:o.dummyInputsPosition,d=a.tagName;this._isOutside=c?c===g.Outside:(r||"UL"===d||"OL"===d||"TABLE"===d)&&!("LI"===d||"TD"===d||"TH"===d),this._firstDummy=new le(this._getWindow,this._isOutside,{isFirst:!0},t),this._lastDummy=new le(this._getWindow,this._isOutside,{isFirst:!1},t);const h=this._firstDummy.input;h&&e._dummyObserver.add(h,this._addDummyInputs),this._firstDummy.onFocusIn=this._onFocusIn,this._firstDummy.onFocusOut=this._onFocusOut,this._lastDummy.onFocusIn=this._onFocusIn,this._lastDummy.onFocusOut=this._onFocusOut,this._element=t,this._addDummyInputs()}dispose(e,t){var s,i,o,n;if(0===(this._wrappers=this._wrappers.filter((s=>s.manager!==e&&!t))).length){delete(null===(s=this._element)||void 0===s?void 0:s.get()).__tabsterDummy;for(const s of this._transformElements)s.removeEventListener("scroll",this._addTransformOffsets);this._transformElements.clear();const e=this._getWindow();this._addTimer&&(e.clearTimeout(this._addTimer),delete this._addTimer);const t=null===(i=this._firstDummy)||void 0===i?void 0:i.input;t&&this._tabster._dummyObserver.remove(t),null===(o=this._firstDummy)||void 0===o||o.dispose(),null===(n=this._lastDummy)||void 0===n||n.dispose()}}_onFocus(e,t,s,i){var o;const n=this._getCurrent();!n||t.useDefaultAction&&!this._callForDefaultAction||null===(o=n.manager.getHandler(e))||void 0===o||o(t,s,i)}_getCurrent(){return this._wrappers.sort(((e,t)=>e.tabbable!==t.tabbable?e.tabbable?-1:1:e.priority-t.priority)),this._wrappers[0]}_ensurePosition(){var e,t,s;const i=null===(e=this._element)||void 0===e?void 0:e.get(),o=null===(t=this._firstDummy)||void 0===t?void 0:t.input,n=null===(s=this._lastDummy)||void 0===s?void 0:s.input;if(i&&o&&n)if(this._isOutside){const e=z.getParentNode(i);if(e){const t=z.getNextSibling(i);t!==n&&z.insertBefore(e,n,t),z.getPreviousElementSibling(i)!==o&&z.insertBefore(e,o,i)}}else{z.getLastElementChild(i)!==n&&z.appendChild(i,n);const e=z.getFirstElementChild(i);e&&e!==o&&e.parentNode&&z.insertBefore(e.parentNode,o,e)}}}function de(e){let t=null;for(let s=z.getLastElementChild(e);s;s=z.getLastElementChild(s))t=s;return t||void 0}function he(e){var t,s;const i=e.ownerDocument,o=null===(t=i.defaultView)||void 0===t?void 0:t.getComputedStyle(e);if(null===e.offsetParent&&i.body!==e&&"fixed"!==(null==o?void 0:o.position))return!0;if("hidden"===(null==o?void 0:o.visibility))return!0;if("fixed"===(null==o?void 0:o.position)){if("none"===o.display)return!0;if(null===(null===(s=e.parentElement)||void 0===s?void 0:s.offsetParent)&&i.body!==e.parentElement)return!0}return!1}function _e(e){return"INPUT"===e.tagName&&!!e.name&&"radio"===e.type}function me(e){var t;return(null===(t=null==e?void 0:e.__tabsterDummyContainer)||void 0===t?void 0:t.get())||null}
/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */function fe(e){return JSON.stringify(e)}function ve(e,t){for(const s of Object.keys(t)){const i=t[s];i?e[s]=i:delete e[s]}}function be(e,t,s){let i;if(s){const t=e.getAttribute(u);if(t)try{i=JSON.parse(t)}catch(Ye){}}i||(i={}),ve(i,t),Object.keys(i).length>0?e.setAttribute(u,fe(i)):e.removeAttribute(u)}class ge extends ae{constructor(e,t,s,i){super(e,t,1,i,void 0,!0),this._onDummyInputFocus=e=>{var t;if(e.useDefaultAction)this._setFocused(!1);else{this._tabster.keyboardNavigation.setNavigatingWithKeyboard(!0);const s=this._element.get();if(s){this._setFocused(!0);const t=this._tabster.focusedElement.getFirstOrLastTabbable(e.isFirst,{container:s,ignoreAccessibility:!0});if(t)return void n(t)}null===(t=e.input)||void 0===t||t.blur()}},this._setHandlers(this._onDummyInputFocus),this._tabster=e,this._setFocused=s}}class pe extends re{constructor(e,t,o,n,r){super(e,t,n),this._isFocused=!1,this._setFocused=e=>{var t;if(this._setFocusedTimer&&(this._tabster.getWindow().clearTimeout(this._setFocusedTimer),delete this._setFocusedTimer),this._isFocused===e)return;const s=this._element.get();s&&(e?(this._isFocused=!0,null===(t=this._dummyManager)||void 0===t||t.setTabbable(!1),s.dispatchEvent(new S({element:s}))):this._setFocusedTimer=this._tabster.getWindow().setTimeout((()=>{var e;delete this._setFocusedTimer,this._isFocused=!1,null===(e=this._dummyManager)||void 0===e||e.setTabbable(!0),s.dispatchEvent(new B({element:s}))}),0))},this._onFocusIn=e=>{const t=this._tabster.getParent,s=this._element.get();let i=e.composedPath()[0];do{if(i===s)return void this._setFocused(!0);i=i&&t(i)}while(i)},this._onFocusOut=()=>{this._setFocused(!1)},this._onDispose=o;const l=e.getWindow;this.uid=ee(l,t),this._sys=r,(e.controlTab||e.rootDummyInputs)&&this.addDummyInputs();const a=l().document;a.addEventListener(s,this._onFocusIn),a.addEventListener(i,this._onFocusOut),this._add()}addDummyInputs(){this._dummyManager||(this._dummyManager=new ge(this._tabster,this._element,this._setFocused,this._sys))}dispose(){var e;this._onDispose(this);const t=this._tabster.getWindow(),o=t.document;o.removeEventListener(s,this._onFocusIn),o.removeEventListener(i,this._onFocusOut),this._setFocusedTimer&&(t.clearTimeout(this._setFocusedTimer),delete this._setFocusedTimer),null===(e=this._dummyManager)||void 0===e||e.dispose(),this._remove()}moveOutWithDefaultAction(e,t){const s=this._dummyManager;if(s)s.moveOutWithDefaultAction(e,t);else{const s=this.getElement();s&&ge.moveWithPhantomDummy(this._tabster,s,!0,e,t)}}_add(){}_remove(){}}class ye{constructor(e,t){this._autoRootWaiting=!1,this._roots={},this._forceDummy=!1,this.rootById={},this._autoRootCreate=()=>{var e;const t=this._win().document,s=t.body;if(s){this._autoRootUnwait(t);const i=this._autoRoot;if(i)return be(s,{root:i},!0),y(this._tabster,s),null===(e=p(this._tabster,s))||void 0===e?void 0:e.root}else this._autoRootWaiting||(this._autoRootWaiting=!0,t.addEventListener("readystatechange",this._autoRootCreate))},this._onRootDispose=e=>{delete this._roots[e.id]},this._tabster=e,this._win=e.getWindow,this._autoRoot=t,e.queueInit((()=>{this._autoRoot&&this._autoRootCreate()}))}_autoRootUnwait(e){e.removeEventListener("readystatechange",this._autoRootCreate),this._autoRootWaiting=!1}dispose(){const e=this._win();this._autoRootUnwait(e.document),delete this._autoRoot,Object.keys(this._roots).forEach((e=>{this._roots[e]&&(this._roots[e].dispose(),delete this._roots[e])})),this.rootById={}}createRoot(e,t,s){const i=new pe(this._tabster,e,this._onRootDispose,t,s);return this._roots[i.id]=i,this._forceDummy&&i.addDummyInputs(),i}addDummyInputs(){this._forceDummy=!0;const e=this._roots;for(const t of Object.keys(e))e[t].addDummyInputs()}static getRootByUId(e,t){const s=e().__tabsterInstance;return s&&s.root.rootById[t]}static getTabsterContext(e,t,s){var i,o,n,r;if(void 0===s&&(s={}),!t.ownerDocument)return;const{checkRtl:l,referenceElement:a}=s,u=e.getParent;let c,d,h,_;e.drainInitQueue();let m,f,v,b,g=!1,y=a||t;const E={};for(;y&&(!c||l);){const s=p(e,y);if(l&&void 0===v){const e=y.dir;e&&(v="rtl"===e.toLowerCase())}if(!s){y=u(y);continue}const r=y.tagName;(s.uncontrolled||"IFRAME"===r||"WEBVIEW"===r)&&e.focusable.isVisible(y)&&(b=y),_||!(null===(i=s.focusable)||void 0===i?void 0:i.excludeFromMover)||h||(g=!0);const a=s.modalizer,T=s.groupper,w=s.mover;!d&&a&&(d=a),h||!T||d&&!a||(d?(!T.isActive()&&T.getProps().tabbability&&d.userId!==(null===(o=e.modalizer)||void 0===o?void 0:o.activeId)&&(d=void 0,h=T),f=T):h=T),_||!w||d&&!a||T&&y===t||!y.contains(t)||(_=w,m=!!h&&h!==T),s.root&&(c=s.root),(null===(n=s.focusable)||void 0===n?void 0:n.ignoreKeydown)&&Object.assign(E,s.focusable.ignoreKeydown),y=u(y)}if(!c){const s=e.root;s._autoRoot&&(null===(r=t.ownerDocument)||void 0===r?void 0:r.body)&&(c=s._autoRootCreate())}return h&&!_&&(m=!0),c?{root:c,modalizer:d,groupper:h,mover:_,groupperBeforeMover:m,modalizerInGroupper:f,rtl:l?!!v:void 0,uncontrolled:b,excludedFromMover:g,ignoreKeydown:e=>!!E[e.key]}:void 0}static getRoot(e,t){var s;const i=e.getParent;for(let o=t;o;o=i(o)){const t=null===(s=p(e,o))||void 0===s?void 0:s.root;if(t)return t}}onRoot(e,t){t?delete this.rootById[e.uid]:this.rootById[e.uid]=e}}
/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */class Ee{}class Te extends Ee{constructor(e,t){super(),this.uid=t.uid,this._tabster=e,this._deloser=t}belongsTo(e){return e===this._deloser}unshift(e){this._deloser.unshift(e)}async focusAvailable(){const e=this._deloser.findAvailable(),t=this._deloser.getElement();return!(!e||!t)&&(t.dispatchEvent(new x({by:"deloser",owner:t,next:e}))?this._tabster.focusedElement.focus(e):null)}async resetFocus(){return oe(this._tabster.getWindow).resolve(this._deloser.resetFocus())}}class we{constructor(e,t){this._history=[],this._tabster=e,this.rootUId=t}getLength(){return this._history.length}removeDeloser(e){this._history=this._history.filter((t=>!t.belongsTo(e)))}hasDeloser(e){return this._history.some((t=>t.belongsTo(e)))}}class Fe extends we{unshiftToDeloser(e,t){let s;for(let i=0;i<this._history.length;i++)if(this._history[i].belongsTo(e)){s=this._history[i],this._history.splice(i,1);break}s||(s=new Te(this._tabster,e)),s.unshift(t),this._history.unshift(s),this._history.splice(10,this._history.length-10)}async focusAvailable(e){let t=!!e;for(const s of this._history)if(e&&s.belongsTo(e)&&(t=!1),!t){const e=await s.focusAvailable();if(e||null===e)return e}return!1}async resetFocus(e){let t=!!e;const s={};for(const i of this._history)e&&i.belongsTo(e)&&(t=!1),t||s[i.uid]||(s[i.uid]=i);for(const i of Object.keys(s))if(await s[i].resetFocus())return!0;return!1}}class De{constructor(e){this._history=[],this._tabster=e}dispose(){this._history=[]}process(e){var t;const s=ye.getTabsterContext(this._tabster,e),i=s&&s.root.uid,o=ke.getDeloser(this._tabster,e);if(!i||!o)return;const n=this.make(i,(()=>new Fe(this._tabster,i)));return s&&s.modalizer&&!(null===(t=s.modalizer)||void 0===t?void 0:t.isActive())||n.unshiftToDeloser(o,e),o}make(e,t){let s;for(let i=0;i<this._history.length;i++){const t=this._history[i];if(t.rootUId===e){s=t,this._history.splice(i,1);break}}return s||(s=t()),this._history.unshift(s),this._history.splice(10,this._history.length-10),s}removeDeloser(e){this._history.forEach((t=>{t.removeDeloser(e)})),this._history=this._history.filter((e=>e.getLength()>0))}async focusAvailable(e){let t=!!e;for(const s of this._history)if(e&&s.hasDeloser(e)&&(t=!1),!t){const t=await s.focusAvailable(e);if(t||null===t)return t}return!1}async resetFocus(e){let t=!!e;for(const s of this._history)if(e&&s.hasDeloser(e)&&(t=!1),!t&&await s.resetFocus(e))return!0;return!1}}function Ce(e,t,s){const i=[],o=/(:|\.|\[|\]|,|=|@)/g,n=e.getAttribute("id");n&&i.push("#"+n.replace(o,"\\$1")),!1!==t&&e.className&&e.className.split(" ").forEach((e=>{(e=e.trim())&&i.push("."+e.replace(o,"\\$1"))}));let r,l=0;if(!1!==s&&0===i.length){for(r=e;r;)l++,r=r.previousElementSibling;i.unshift(":nth-child("+l+")")}return i.unshift(e.tagName.toLowerCase()),i.join("")}class Ie extends re{constructor(e,t,s,i){super(e,t,i),this._isActive=!1,this._history=[[]],this._snapshotIndex=0,this.isActive=()=>this._isActive,this.setSnapshot=e=>{this._snapshotIndex=e,this._history.length>e+1&&this._history.splice(e+1,this._history.length-e-1),this._history[e]||(this._history[e]=[])},this.focusFirst=()=>{const e=this._element.get();return!!e&&this._tabster.focusedElement.focusFirst({container:e})},this.focusDefault=()=>{const e=this._element.get();return!!e&&this._tabster.focusedElement.focusDefault(e)},this.resetFocus=()=>{const e=this._element.get();return!!e&&this._tabster.focusedElement.resetFocus(e)},this.clearHistory=e=>{const t=this._element.get();this._history[this._snapshotIndex]=t?this._history[this._snapshotIndex].filter((s=>{const i=s.get();return!(!i||!e)&&z.nodeContains(t,i)})):[]},this.uid=ee(e.getWindow,t),this.strategy=i.strategy||m.Auto,this._onDispose=s}dispose(){this._remove(),this._onDispose(this),this._isActive=!1,this._snapshotIndex=0,this._props={},this._history=[]}setActive(e){this._isActive=e}getActions(){return{focusDefault:this.focusDefault,focusFirst:this.focusFirst,resetFocus:this.resetFocus,clearHistory:this.clearHistory,setSnapshot:this.setSnapshot,isActive:this.isActive}}unshift(e){let t=this._history[this._snapshotIndex];for(t=this._history[this._snapshotIndex]=t.filter((t=>{const s=t.get();return s&&s!==e})),t.unshift(new Q(this._tabster.getWindow,e,function(e){if(!se(e.ownerDocument,e))return;const t=[Ce(e)];let s=z.getParentNode(e);for(;s&&s.nodeType!==Node.DOCUMENT_FRAGMENT_NODE;){if(s.nodeType===Node.ELEMENT_NODE){const e="BODY"===s.tagName;if(t.unshift(Ce(s,!1,!e)),e)break}s=z.getParentNode(s)}return t.join(" ")}(e)));t.length>10;)t.pop()}findAvailable(){const e=this._element.get();if(!e||!this._tabster.focusable.isVisible(e))return null;let t=this._props.restoreFocusOrder,s=null;const i=ye.getTabsterContext(this._tabster,e);if(!i)return null;const o=i.root,n=o.getElement();if(!n)return null;if(void 0===t&&(t=o.getProps().restoreFocusOrder),t===_.RootDefault&&(s=this._tabster.focusable.findDefault({container:n})),s||t!==_.RootFirst||(s=this._findFirst(n)),s)return s;const r=this._findInHistory();if(r&&t===_.History)return r;const l=this._tabster.focusable.findDefault({container:e});if(l&&t===_.DeloserDefault)return l;const a=this._findFirst(e);return a&&t===_.DeloserFirst?a:l||r||a||null}customFocusLostHandler(e){return e.dispatchEvent(new W(this.getActions()))}_findInHistory(){const e=this._history[this._snapshotIndex].slice(0);this.clearHistory(!0);for(let s=0;s<e.length;s++){const i=e[s],o=i.get(),n=this._element.get();if(o&&n&&z.nodeContains(n,o)){if(this._tabster.focusable.isFocusable(o))return o}else if(!this._props.noSelectorCheck){const e=i.getData();if(e&&n){let s;try{s=z.querySelectorAll(n.ownerDocument,e)}catch(t){continue}for(let e=0;e<s.length;e++){const t=s[e];if(t&&this._tabster.focusable.isFocusable(t))return t}}}}return null}_findFirst(e){if(this._tabster.keyboardNavigation.isNavigatingWithKeyboard()){const t=this._tabster.focusable.findFirst({container:e,useActiveModalizer:!0});if(t)return t}return null}_remove(){}}class ke{constructor(e,t){this._inDeloser=!1,this._isRestoringFocus=!1,this._isPaused=!1,this._onRestoreFocus=e=>{var t;const s=e.composedPath()[0];if(s){const i=null===(t=ke.getDeloser(this._tabster,s))||void 0===t?void 0:t.findAvailable();i&&this._tabster.focusedElement.focus(i),e.stopImmediatePropagation()}},this._onFocus=e=>{if(this._restoreFocusTimer&&(this._win().clearTimeout(this._restoreFocusTimer),this._restoreFocusTimer=void 0),!e)return void this._scheduleRestoreFocus();const t=this._history.process(e);t?this._activate(t):this._deactivate()},this._onDeloserDispose=e=>{this._history.removeDeloser(e),e.isActive()&&this._scheduleRestoreFocus()},this._tabster=e,this._win=e.getWindow,this._history=new De(e),e.queueInit((()=>{this._tabster.focusedElement.subscribe(this._onFocus);const e=this._win().document;e.addEventListener(D,this._onRestoreFocus);const t=z.getActiveElement(e);t&&t!==e.body&&this._onFocus(t)}));const s=null==t?void 0:t.autoDeloser;s&&(this._autoDeloser=s)}dispose(){const e=this._win();this._restoreFocusTimer&&(e.clearTimeout(this._restoreFocusTimer),this._restoreFocusTimer=void 0),this._autoDeloserInstance&&(this._autoDeloserInstance.dispose(),delete this._autoDeloserInstance,delete this._autoDeloser),this._tabster.focusedElement.unsubscribe(this._onFocus),e.document.removeEventListener(D,this._onRestoreFocus),this._history.dispose(),delete this._curDeloser}createDeloser(e,t){var s;const i=new Ie(this._tabster,e,this._onDeloserDispose,t);return z.nodeContains(e,null!==(s=this._tabster.focusedElement.getFocusedElement())&&void 0!==s?s:null)&&this._activate(i),i}getActions(e){for(let t=e;t;t=z.getParentElement(t)){const e=p(this._tabster,t);if(e&&e.deloser)return e.deloser.getActions()}}pause(){this._isPaused=!0,this._restoreFocusTimer&&(this._win().clearTimeout(this._restoreFocusTimer),this._restoreFocusTimer=void 0)}resume(e){this._isPaused=!1,e&&this._scheduleRestoreFocus()}_activate(e){const t=this._curDeloser;t!==e&&(this._inDeloser=!0,null==t||t.setActive(!1),e.setActive(!0),this._curDeloser=e)}_deactivate(){var e;this._inDeloser=!1,null===(e=this._curDeloser)||void 0===e||e.setActive(!1),this._curDeloser=void 0}_scheduleRestoreFocus(e){if(this._isPaused||this._isRestoringFocus)return;const t=async()=>{this._restoreFocusTimer=void 0;const t=this._tabster.focusedElement.getLastFocusedElement();if(!e&&(this._isRestoringFocus||!this._inDeloser||t&&!he(t)))return;const s=this._curDeloser;let i=!1;if(s){if(t&&s.customFocusLostHandler(t))return;if(s.strategy===m.Manual)i=!0;else{const e=s.getElement(),t=s.findAvailable();if(t&&(!(null==e?void 0:e.dispatchEvent(new x({by:"deloser",owner:e,next:t})))||this._tabster.focusedElement.focus(t)))return}}this._deactivate(),i||(this._isRestoringFocus=!0,!1===await this._history.focusAvailable(null)&&await this._history.resetFocus(null),this._isRestoringFocus=!1)};e?t():this._restoreFocusTimer=this._win().setTimeout(t,100)}static getDeloser(e,t){var s;let i;for(let n=t;n;n=z.getParentElement(n)){const t=p(e,n);if(t){i||(i=t.root);const e=t.deloser;if(e)return e}}const o=e.deloser&&e.deloser;if(o){if(o._autoDeloserInstance)return o._autoDeloserInstance;const n=o._autoDeloser;if(i&&!o._autoDeloserInstance&&n){const i=null===(s=t.ownerDocument)||void 0===s?void 0:s.body;i&&(o._autoDeloserInstance=new Ie(e,i,e.deloser._onDeloserDispose,n))}return o._autoDeloserInstance}}static getHistory(e){return e._history}static forceRestoreFocus(e){e._scheduleRestoreFocus(!0)}}
/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */class Oe{constructor(){this._callbacks=[]}dispose(){this._callbacks=[],delete this._val}subscribe(e){const t=this._callbacks;t.indexOf(e)<0&&t.push(e)}subscribeFirst(e){const t=this._callbacks,s=t.indexOf(e);s>=0&&t.splice(s,1),t.unshift(e)}unsubscribe(e){const t=this._callbacks.indexOf(e);t>=0&&this._callbacks.splice(t,1)}setVal(e,t){this._val!==e&&(this._val=e,this._callCallbacks(e,t))}getVal(){return this._val}trigger(e,t){this._callCallbacks(e,t)}_callCallbacks(e,t){this._callbacks.forEach((s=>s(e,t)))}}
/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */class Re{constructor(e){this._tabster=e}dispose(){}getProps(e){const t=p(this._tabster,e);return t&&t.focusable||{}}isFocusable(e,t,s,i){return!(!ie(e,d)||!t&&-1===e.tabIndex)&&(s||this.isVisible(e))&&(i||this.isAccessible(e))}isVisible(e){if(!e.ownerDocument||e.nodeType!==Node.ELEMENT_NODE)return!1;if(he(e))return!1;const t=e.ownerDocument.body.getBoundingClientRect();return 0!==t.width||0!==t.height}isAccessible(e){var t;for(let s=e;s;s=z.getParentElement(s)){const e=p(this._tabster,s);if(this._isHidden(s))return!1;if(!(null===(t=null==e?void 0:e.focusable)||void 0===t?void 0:t.ignoreAriaDisabled)&&this._isDisabled(s))return!1}return!0}_isDisabled(e){return e.hasAttribute("disabled")}_isHidden(e){var t;const s=e.getAttribute("aria-hidden");return!(!s||"true"!==s.toLowerCase()||(null===(t=this._tabster.modalizer)||void 0===t?void 0:t.isAugmented(e)))}findFirst(e,t){return this.findElement({...e},t)}findLast(e,t){return this.findElement({isBackward:!0,...e},t)}findNext(e,t){return this.findElement({...e},t)}findPrev(e,t){return this.findElement({...e,isBackward:!0},t)}findDefault(e,t){return this.findElement({...e,acceptCondition:t=>this.isFocusable(t,e.includeProgrammaticallyFocusable)&&!!this.getProps(t).isDefault},t)||null}findAll(e){return this._findElements(!0,e)||[]}findElement(e,t){const s=this._findElements(!1,e,t);return s?s[0]:s}_findElements(e,t,s){var i,o,n;const{container:r,currentElement:l=null,includeProgrammaticallyFocusable:a,useActiveModalizer:u,ignoreAccessibility:c,modalizerId:d,isBackward:h,onElement:_}=t;s||(s={});const m=[];let{acceptCondition:f}=t;const v=!!f;if(!r)return null;f||(f=e=>this.isFocusable(e,a,!1,c));const b={container:r,modalizerUserId:void 0===d&&u?null===(i=this._tabster.modalizer)||void 0===i?void 0:i.activeId:d||(null===(n=null===(o=ye.getTabsterContext(this._tabster,r))||void 0===o?void 0:o.modalizer)||void 0===n?void 0:n.userId),from:l||r,isBackward:h,isFindAll:e,acceptCondition:f,hasCustomCondition:v,includeProgrammaticallyFocusable:a,ignoreAccessibility:c,cachedGrouppers:{},cachedRadioGroups:{}},g=J(r.ownerDocument,r,(e=>this._acceptElement(e,b)));if(!g)return null;const p=t=>{var i,o;const n=null!==(i=b.foundElement)&&void 0!==i?i:b.foundBackward;return n&&m.push(n),e?!(n&&(b.found=!1,delete b.foundElement,delete b.foundBackward,delete b.fromCtx,b.from=n,_&&!_(n))||!n&&!t):(n&&s&&(s.uncontrolled=null===(o=ye.getTabsterContext(this._tabster,n))||void 0===o?void 0:o.uncontrolled),!(!t||n))};if(l||(s.outOfDOMOrder=!0),l&&z.nodeContains(r,l))g.currentNode=l;else if(h){const e=de(r);if(!e)return null;if(this._acceptElement(e,b)===NodeFilter.FILTER_ACCEPT&&!p(!0))return b.skippedFocusable&&(s.outOfDOMOrder=!0),m;g.currentNode=e}do{h?g.previousNode():g.nextNode()}while(p());return b.skippedFocusable&&(s.outOfDOMOrder=!0),m.length?m:null}_acceptElement(e,t){var s,i,o;if(t.found)return NodeFilter.FILTER_ACCEPT;const n=t.foundBackward;if(n&&(e===n||!z.nodeContains(n,e)))return t.found=!0,t.foundElement=n,NodeFilter.FILTER_ACCEPT;const r=t.container;if(e===r)return NodeFilter.FILTER_SKIP;if(!z.nodeContains(r,e))return NodeFilter.FILTER_REJECT;if(me(e))return NodeFilter.FILTER_REJECT;if(z.nodeContains(t.rejectElementsFrom,e))return NodeFilter.FILTER_REJECT;const l=t.currentCtx=ye.getTabsterContext(this._tabster,e);if(!l)return NodeFilter.FILTER_SKIP;if(Z(e))return this.isFocusable(e,void 0,!0,!0)&&(t.skippedFocusable=!0),NodeFilter.FILTER_SKIP;if(!t.hasCustomCondition&&("IFRAME"===e.tagName||"WEBVIEW"===e.tagName))return this.isVisible(e)&&(null===(s=l.modalizer)||void 0===s?void 0:s.userId)===(null===(i=this._tabster.modalizer)||void 0===i?void 0:i.activeId)?(t.found=!0,t.rejectElementsFrom=t.foundElement=e,NodeFilter.FILTER_ACCEPT):NodeFilter.FILTER_REJECT;if(!t.ignoreAccessibility&&!this.isAccessible(e))return this.isFocusable(e,!1,!0,!0)&&(t.skippedFocusable=!0),NodeFilter.FILTER_REJECT;let a,u=t.fromCtx;u||(u=t.fromCtx=ye.getTabsterContext(this._tabster,t.from));const c=null==u?void 0:u.mover;let d=l.groupper,h=l.mover;if(a=null===(o=this._tabster.modalizer)||void 0===o?void 0:o.acceptElement(e,t),void 0!==a&&(t.skippedFocusable=!0),void 0===a&&(d||h||c)){const s=null==d?void 0:d.getElement(),i=null==c?void 0:c.getElement();let o=null==h?void 0:h.getElement();if(o&&z.nodeContains(i,o)&&z.nodeContains(r,i)&&(!s||!h||z.nodeContains(i,s))&&(h=c,o=i),s)if(s!==r&&z.nodeContains(r,s)){if(!z.nodeContains(s,e))return NodeFilter.FILTER_REJECT}else d=void 0;if(o)if(z.nodeContains(r,o)){if(!z.nodeContains(o,e))return NodeFilter.FILTER_REJECT}else h=void 0;d&&h&&(o&&s&&!z.nodeContains(s,o)?h=void 0:d=void 0),d&&(a=d.acceptElement(e,t)),h&&(a=h.acceptElement(e,t))}if(void 0===a&&(a=t.acceptCondition(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP,a===NodeFilter.FILTER_SKIP&&this.isFocusable(e,!1,!0,!0)&&(t.skippedFocusable=!0)),a===NodeFilter.FILTER_ACCEPT&&!t.found){if(!t.isFindAll&&_e(e)&&!e.checked){const s=e.name;let i=t.cachedRadioGroups[s];if(i||(i=function(e){if(!_e(e))return;const t=e.name;let s,i=Array.from(z.getElementsByName(e,t));return i=i.filter((e=>!!_e(e)&&(e.checked&&(s=e),!0))),{name:t,buttons:new Set(i),checked:s}}(e),i&&(t.cachedRadioGroups[s]=i)),(null==i?void 0:i.checked)&&i.checked!==e)return NodeFilter.FILTER_SKIP}t.isBackward?(t.foundBackward=e,a=NodeFilter.FILTER_SKIP):(t.found=!0,t.foundElement=e)}return a}}
/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */const Ne="Home",Me="ArrowLeft",Ae="ArrowUp",Pe="ArrowRight",xe="ArrowDown",Le={[h.Restorer]:0,[h.Deloser]:1,[h.EscapeGroupper]:2};
/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */class We extends Oe{constructor(e,t){super(),this._init=()=>{const e=this._win(),t=e.document;t.addEventListener(s,this._onFocusIn,!0),t.addEventListener(i,this._onFocusOut,!0),e.addEventListener("keydown",this._onKeyDown,!0);const o=z.getActiveElement(t);o&&o!==t.body&&this._setFocusedElement(o),this.subscribe(this._onChanged)},this._onFocusIn=e=>{const t=e.composedPath()[0];t&&this._setFocusedElement(t,e.detail.relatedTarget,e.detail.isFocusedProgrammatically)},this._onFocusOut=e=>{var t;this._setFocusedElement(void 0,null===(t=e.detail)||void 0===t?void 0:t.originalEvent.relatedTarget)},this._validateFocusedElement=()=>{},this._onKeyDown=e=>{if("Tab"!==e.key||e.ctrlKey)return;const t=this.getVal();if(!t||!t.ownerDocument||"true"===t.contentEditable)return;const s=this._tabster,i=s.controlTab,o=ye.getTabsterContext(s,t);if(!o||o.ignoreKeydown(e))return;const r=e.shiftKey,l=We.findNextTabbable(s,o,void 0,t,void 0,r,!0),a=o.root.getElement();if(!a)return;const u=null==l?void 0:l.element,c=function(e,t){var s;const i=e.getParent;let o=t;do{const t=null===(s=p(e,o))||void 0===s?void 0:s.uncontrolled;if(t&&e.uncontrolled.isUncontrolledCompletely(o,!!t.completely))return o;o=i(o)}while(o)}(s,t);if(u){const d=l.uncontrolled;if(o.uncontrolled||z.nodeContains(d,t)){if(!l.outOfDOMOrder&&d===o.uncontrolled||c&&!z.nodeContains(c,u))return;return void ae.addPhantomDummyWithTarget(s,t,r,u)}if(d&&s.focusable.isVisible(d)||"IFRAME"===u.tagName&&s.focusable.isVisible(u))return void(a.dispatchEvent(new x({by:"root",owner:a,next:u,relatedEvent:e}))&&ae.moveWithPhantomDummy(s,null!=d?d:u,!1,r,e));(i||(null==l?void 0:l.outOfDOMOrder))&&a.dispatchEvent(new x({by:"root",owner:a,next:u,relatedEvent:e}))&&(e.preventDefault(),e.stopImmediatePropagation(),n(u))}else!c&&a.dispatchEvent(new x({by:"root",owner:a,next:null,relatedEvent:e}))&&o.root.moveOutWithDefaultAction(r,e)},this._onChanged=(e,t)=>{var s,i;if(e)e.dispatchEvent(new A(t));else{const e=null===(s=this._lastVal)||void 0===s?void 0:s.get();if(e){const s={...t},o=ye.getTabsterContext(this._tabster,e),n=null===(i=null==o?void 0:o.modalizer)||void 0===i?void 0:i.userId;n&&(s.modalizerId=n),e.dispatchEvent(new P(s))}}},this._tabster=e,this._win=t,e.queueInit(this._init)}dispose(){super.dispose();const e=this._win(),t=e.document;t.removeEventListener(s,this._onFocusIn,!0),t.removeEventListener(i,this._onFocusOut,!0),e.removeEventListener("keydown",this._onKeyDown,!0),this.unsubscribe(this._onChanged);const o=this._asyncFocus;o&&(e.clearTimeout(o.timeout),delete this._asyncFocus),delete We._lastResetElement,delete this._nextVal,delete this._lastVal}static forgetMemorized(e,t){var s,i;let o=We._lastResetElement,n=o&&o.get();n&&z.nodeContains(t,n)&&delete We._lastResetElement,n=null===(i=null===(s=e._nextVal)||void 0===s?void 0:s.element)||void 0===i?void 0:i.get(),n&&z.nodeContains(t,n)&&delete e._nextVal,o=e._lastVal,n=o&&o.get(),n&&z.nodeContains(t,n)&&delete e._lastVal}getFocusedElement(){return this.getVal()}getLastFocusedElement(){var e;let t=null===(e=this._lastVal)||void 0===e?void 0:e.get();return(!t||t&&!se(t.ownerDocument,t))&&(this._lastVal=t=void 0),t}focus(e,t,s,i){return!!this._tabster.focusable.isFocusable(e,t,!1,s)&&(e.focus({preventScroll:i}),!0)}focusDefault(e){const t=this._tabster.focusable.findDefault({container:e});return!!t&&(this._tabster.focusedElement.focus(t),!0)}getFirstOrLastTabbable(e,t){var s;const{container:i,ignoreAccessibility:o}=t;let n;if(i){const t=ye.getTabsterContext(this._tabster,i);t&&(n=null===(s=We.findNextTabbable(this._tabster,t,i,void 0,void 0,!e,o))||void 0===s?void 0:s.element)}return n&&!z.nodeContains(i,n)&&(n=void 0),n||void 0}_focusFirstOrLast(e,t){const s=this.getFirstOrLastTabbable(e,t);return!!s&&(this.focus(s,!1,!0),!0)}focusFirst(e){return this._focusFirstOrLast(!0,e)}focusLast(e){return this._focusFirstOrLast(!1,e)}resetFocus(e){if(!this._tabster.focusable.isVisible(e))return!1;if(this._tabster.focusable.isFocusable(e,!0,!0,!0))this.focus(e);else{const t=e.getAttribute("tabindex"),s=e.getAttribute("aria-hidden");e.tabIndex=-1,e.setAttribute("aria-hidden","true"),We._lastResetElement=new Q(this._win,e),this.focus(e,!0,!0),this._setOrRemoveAttribute(e,"tabindex",t),this._setOrRemoveAttribute(e,"aria-hidden",s)}return!0}requestAsyncFocus(e,t,s){const i=this._tabster.getWindow(),o=this._asyncFocus;if(o){if(Le[e]>Le[o.source])return;i.clearTimeout(o.timeout)}this._asyncFocus={source:e,callback:t,timeout:i.setTimeout((()=>{this._asyncFocus=void 0,t()}),s)}}cancelAsyncFocus(e){const t=this._asyncFocus;(null==t?void 0:t.source)===e&&(this._tabster.getWindow().clearTimeout(t.timeout),this._asyncFocus=void 0)}_setOrRemoveAttribute(e,t,s){null===s?e.removeAttribute(t):e.setAttribute(t,s)}_setFocusedElement(e,t,s){var i,o;if(this._tabster._noop)return;const n={relatedTarget:t};if(e){const t=null===(i=We._lastResetElement)||void 0===i?void 0:i.get();if(We._lastResetElement=void 0,t===e||Z(e))return;n.isFocusedProgrammatically=s;const r=ye.getTabsterContext(this._tabster,e),l=null===(o=null==r?void 0:r.modalizer)||void 0===o?void 0:o.userId;l&&(n.modalizerId=l)}const r=this._nextVal={element:e?new Q(this._win,e):void 0,detail:n};e&&e!==this._val&&this._validateFocusedElement(e),this._nextVal===r&&this.setVal(e,n),this._nextVal=void 0}setVal(e,t){super.setVal(e,t),e&&(this._lastVal=new Q(this._win,e))}static findNextTabbable(e,t,s,i,o,n,r){const l=s||t.root.getElement();if(!l)return null;let a=null;const u=We._isTabbingTimer,c=e.getWindow();u&&c.clearTimeout(u),We.isTabbing=!0,We._isTabbingTimer=c.setTimeout((()=>{delete We._isTabbingTimer,We.isTabbing=!1}),0);const d=t.modalizer,h=t.groupper,_=t.mover,m=t=>{if(a=t.findNextTabbable(i,o,n,r),i&&!(null==a?void 0:a.element)){const o=t!==d&&z.getParentElement(t.getElement());if(o){const l=ye.getTabsterContext(e,i,{referenceElement:o});if(l){const i=t.getElement(),u=n?i:i&&de(i)||i;u&&(a=We.findNextTabbable(e,l,s,u,o,n,r),a&&(a.outOfDOMOrder=!0))}}}};if(h&&_)m(t.groupperBeforeMover?h:_);else if(h)m(h);else if(_)m(_);else if(d)m(d);else{const t={container:l,currentElement:i,referenceElement:o,ignoreAccessibility:r,useActiveModalizer:!0},s={},u=e.focusable[n?"findPrev":"findNext"](t,s);a={element:u,outOfDOMOrder:s.outOfDOMOrder,uncontrolled:s.uncontrolled}}return a}}We.isTabbing=!1;
/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */
class Se extends Oe{constructor(e){var t;super(),this._onChange=e=>{this.setVal(e,void 0)},this._keyborg=(t=e(),a.create(t,void 0)),this._keyborg.subscribe(this._onChange)}dispose(){var e;super.dispose(),this._keyborg&&(this._keyborg.unsubscribe(this._onChange),e=this._keyborg,a.dispose(e),delete this._keyborg)}setNavigatingWithKeyboard(e){var t;null===(t=this._keyborg)||void 0===t||t.setVal(e)}isNavigatingWithKeyboard(){var e;return!!(null===(e=this._keyborg)||void 0===e?void 0:e.isNavigatingWithKeyboard())}}
/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */const Be=["input","textarea","*[contenteditable]"].join(", ");class ze extends ae{constructor(e,t,s,i){super(t,e,3,i),this._onFocusDummyInput=e=>{var t,s;const i=this._element.get(),o=e.input;if(i&&o){const r=ye.getTabsterContext(this._tabster,i);let l;r&&(l=null===(t=We.findNextTabbable(this._tabster,r,void 0,o,void 0,!e.isFirst,!0))||void 0===t?void 0:t.element);const a=null===(s=this._getMemorized())||void 0===s?void 0:s.get();a&&this._tabster.focusable.isFocusable(a)&&(l=a),l&&n(l)}},this._tabster=t,this._getMemorized=s,this._setHandlers(this._onFocusDummyInput)}}class Ue extends re{constructor(e,t,s,i,o){var n;super(e,t,i),this._visible={},this._onIntersection=e=>{for(const t of e){const e=t.target,s=ee(this._win,e);let i,o=this._fullyVisible;if(t.intersectionRatio>=.25?(i=t.intersectionRatio>=.75?f.Visible:f.PartiallyVisible,i===f.Visible&&(o=s)):i=f.Invisible,this._visible[s]!==i){void 0===i?(delete this._visible[s],o===s&&delete this._fullyVisible):(this._visible[s]=i,this._fullyVisible=o);const t=this.getState(e);t&&e.dispatchEvent(new L(t))}}},this._win=e.getWindow,this.visibilityTolerance=null!==(n=i.visibilityTolerance)&&void 0!==n?n:.8,(this._props.trackState||this._props.visibilityAware)&&(this._intersectionObserver=new IntersectionObserver(this._onIntersection,{threshold:[0,.25,.5,.75,1]}),this._observeState()),this._onDispose=s,e.controlTab||(this.dummyManager=new ze(this._element,e,(()=>i.memorizeCurrent?this._current:void 0),o))}dispose(){var e;this._onDispose(this),this._intersectionObserver&&(this._intersectionObserver.disconnect(),delete this._intersectionObserver),delete this._current,delete this._fullyVisible,delete this._allElements,delete this._updateQueue,this._unobserve&&(this._unobserve(),delete this._unobserve);const t=this._win();this._setCurrentTimer&&(t.clearTimeout(this._setCurrentTimer),delete this._setCurrentTimer),this._updateTimer&&(t.clearTimeout(this._updateTimer),delete this._updateTimer),null===(e=this.dummyManager)||void 0===e||e.dispose(),delete this.dummyManager}setCurrent(e){this._current=e?new Q(this._win,e):void 0,!this._props.trackState&&!this._props.visibilityAware||this._setCurrentTimer||(this._setCurrentTimer=this._win().setTimeout((()=>{var e;delete this._setCurrentTimer;const t=[];this._current!==this._prevCurrent&&(t.push(this._current),t.push(this._prevCurrent),this._prevCurrent=this._current);for(const s of t){const t=null==s?void 0:s.get();if(t&&(null===(e=this._allElements)||void 0===e?void 0:e.get(t))===this){const e=this._props;if(t&&(void 0!==e.visibilityAware||e.trackState)){const e=this.getState(t);e&&t.dispatchEvent(new L(e))}}}})))}getCurrent(){var e;return(null===(e=this._current)||void 0===e?void 0:e.get())||null}findNextTabbable(e,t,s,i){const o=this.getElement(),n=o&&me(e)===o;if(!o)return null;let r,l=null,a=!1;if(this._props.tabbable||n||e&&!z.nodeContains(o,e)){const n={currentElement:e,referenceElement:t,container:o,ignoreAccessibility:i,useActiveModalizer:!0},u={};l=this._tabster.focusable[s?"findPrev":"findNext"](n,u),a=!!u.outOfDOMOrder,r=u.uncontrolled}return{element:l,uncontrolled:r,outOfDOMOrder:a}}acceptElement(e,t){var s,i;if(!We.isTabbing)return(null===(s=t.currentCtx)||void 0===s?void 0:s.excludedFromMover)?NodeFilter.FILTER_REJECT:void 0;const{memorizeCurrent:o,visibilityAware:n,hasDefault:r=!0}=this._props,l=this.getElement();if(l&&(o||n||r)&&(!z.nodeContains(l,t.from)||me(t.from)===l)){let e;if(o){const s=null===(i=this._current)||void 0===i?void 0:i.get();s&&t.acceptCondition(s)&&(e=s)}if(!e&&r&&(e=this._tabster.focusable.findDefault({container:l,useActiveModalizer:!0})),!e&&n&&(e=this._tabster.focusable.findElement({container:l,useActiveModalizer:!0,isBackward:t.isBackward,acceptCondition:e=>{var s;const i=ee(this._win,e),o=this._visible[i];return l!==e&&!!(null===(s=this._allElements)||void 0===s?void 0:s.get(e))&&t.acceptCondition(e)&&(o===f.Visible||o===f.PartiallyVisible&&(n===f.PartiallyVisible||!this._fullyVisible))}})),e)return t.found=!0,t.foundElement=e,t.rejectElementsFrom=l,t.skippedFocusable=!0,NodeFilter.FILTER_ACCEPT}}_observeState(){const e=this.getElement();if(this._unobserve||!e||"undefined"==typeof MutationObserver)return;const t=this._win(),s=this._allElements=new WeakMap,i=this._tabster.focusable;let o=this._updateQueue=[];const n=z.createMutationObserver((e=>{for(const t of e){const e=t.target,s=t.removedNodes,i=t.addedNodes;if("attributes"===t.type)"tabindex"===t.attributeName&&o.push({element:e,type:2});else{for(let e=0;e<s.length;e++)o.push({element:s[e],type:3});for(let e=0;e<i.length;e++)o.push({element:i[e],type:1})}}c()})),r=(e,t)=>{var i,o;const n=s.get(e);n&&t&&(null===(i=this._intersectionObserver)||void 0===i||i.unobserve(e),s.delete(e)),n||t||(s.set(e,this),null===(o=this._intersectionObserver)||void 0===o||o.observe(e))},l=e=>{const t=i.isFocusable(e);s.get(e)?t||r(e,!0):t&&r(e)},a=e=>{const{mover:s}=d(e);if(s&&s!==this){if(s.getElement()!==e||!i.isFocusable(e))return;r(e)}const o=J(t.document,e,(e=>{const{mover:t,groupper:s}=d(e);if(t&&t!==this)return NodeFilter.FILTER_REJECT;const o=null==s?void 0:s.getFirst(!0);return s&&s.getElement()!==e&&o&&o!==e?NodeFilter.FILTER_REJECT:(i.isFocusable(e)&&r(e),NodeFilter.FILTER_SKIP)}));if(o)for(o.currentNode=e;o.nextNode(););},u=e=>{s.get(e)&&r(e,!0);for(let t=z.getFirstElementChild(e);t;t=z.getNextElementSibling(t))u(t)},c=()=>{!this._updateTimer&&o.length&&(this._updateTimer=t.setTimeout((()=>{delete this._updateTimer;for(const{element:e,type:t}of o)switch(t){case 2:l(e);break;case 1:a(e);break;case 3:u(e)}o=this._updateQueue=[]}),0))},d=e=>{const t={};for(let s=e;s;s=z.getParentElement(s)){const e=p(this._tabster,s);if(e&&(e.groupper&&!t.groupper&&(t.groupper=e.groupper),e.mover)){t.mover=e.mover;break}}return t};o.push({element:e,type:1}),c(),n.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["tabindex"]}),this._unobserve=()=>{n.disconnect()}}getState(e){const t=ee(this._win,e);if(t in this._visible){const s=this._visible[t]||f.Invisible;return{isCurrent:this._current?this._current.get()===e:void 0,visibility:s}}}}class Ke{constructor(e,t){this._init=()=>{const e=this._win();e.addEventListener("keydown",this._onKeyDown,!0),e.addEventListener(I,this._onMoveFocus),e.addEventListener(k,this._onMemorizedElement),this._tabster.focusedElement.subscribe(this._onFocus)},this._onMoverDispose=e=>{delete this._movers[e.id]},this._onFocus=e=>{var t;let s=e,i=e;for(let o=z.getParentElement(e);o;o=z.getParentElement(o)){const e=null===(t=p(this._tabster,o))||void 0===t?void 0:t.mover;e&&(e.setCurrent(i),s=void 0),!s&&this._tabster.focusable.isFocusable(o)&&(s=i=o)}},this._onKeyDown=async e=>{var t;if(this._ignoredInputTimer&&(this._win().clearTimeout(this._ignoredInputTimer),delete this._ignoredInputTimer),null===(t=this._ignoredInputResolve)||void 0===t||t.call(this,!1),e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)return;const s=e.key;let i;if(s===xe?i=b.ArrowDown:s===Pe?i=b.ArrowRight:s===Ae?i=b.ArrowUp:s===Me?i=b.ArrowLeft:"PageDown"===s?i=b.PageDown:"PageUp"===s?i=b.PageUp:s===Ne?i=b.Home:"End"===s&&(i=b.End),!i)return;const o=this._tabster.focusedElement.getFocusedElement();o&&!(await this._isIgnoredInput(o,s))&&this._moveFocus(o,i,e)},this._onMoveFocus=e=>{var t;const s=e.composedPath()[0],i=null===(t=e.detail)||void 0===t?void 0:t.key;s&&void 0!==i&&!e.defaultPrevented&&(this._moveFocus(s,i),e.stopImmediatePropagation())},this._onMemorizedElement=e=>{var t;const s=e.composedPath()[0];let i=null===(t=e.detail)||void 0===t?void 0:t.memorizedElement;if(s){const t=ye.getTabsterContext(this._tabster,s),o=null==t?void 0:t.mover;o&&(i&&!z.nodeContains(o.getElement(),i)&&(i=void 0),o.setCurrent(i),e.stopImmediatePropagation())}},this._tabster=e,this._win=t,this._movers={},e.queueInit(this._init)}dispose(){var e;const t=this._win();this._tabster.focusedElement.unsubscribe(this._onFocus),null===(e=this._ignoredInputResolve)||void 0===e||e.call(this,!1),this._ignoredInputTimer&&(t.clearTimeout(this._ignoredInputTimer),delete this._ignoredInputTimer),t.removeEventListener("keydown",this._onKeyDown,!0),t.removeEventListener(I,this._onMoveFocus),t.removeEventListener(k,this._onMemorizedElement),Object.keys(this._movers).forEach((e=>{this._movers[e]&&(this._movers[e].dispose(),delete this._movers[e])}))}createMover(e,t,s){const i=new Ue(this._tabster,e,this._onMoverDispose,t,s);return this._movers[i.id]=i,i}moveFocus(e,t){return this._moveFocus(e,t)}_moveFocus(e,t,s){var i,o;const r=this._tabster,l=ye.getTabsterContext(r,e,{checkRtl:!0});if(!l||!l.mover||l.excludedFromMover||s&&l.ignoreKeydown(s))return null;const a=l.mover,u=a.getElement();if(l.groupperBeforeMover){const e=l.groupper;if(!e||e.isActive(!0))return null;for(let t=z.getParentElement(e.getElement());t&&t!==u;t=z.getParentElement(t))if(null===(o=null===(i=p(r,t))||void 0===i?void 0:i.groupper)||void 0===o?void 0:o.isActive(!0))return null}if(!u)return null;const c=r.focusable,d=a.getProps(),h=d.direction||v.Both,_=h===v.Both,m=_||h===v.Vertical,f=_||h===v.Horizontal,g=h===v.GridLinear,y=g||h===v.Grid,E=d.cyclic;let T,w,F,D=0,C=0;if(y&&(F=e.getBoundingClientRect(),D=Math.ceil(F.left),C=Math.floor(F.right)),l.rtl&&(t===b.ArrowRight?t=b.ArrowLeft:t===b.ArrowLeft&&(t=b.ArrowRight)),t===b.ArrowDown&&m||t===b.ArrowRight&&(f||y))if(T=c.findNext({currentElement:e,container:u,useActiveModalizer:!0}),T&&y){const e=Math.ceil(T.getBoundingClientRect().left);!g&&C>e&&(T=void 0)}else!T&&E&&(T=c.findFirst({container:u,useActiveModalizer:!0}));else if(t===b.ArrowUp&&m||t===b.ArrowLeft&&(f||y))if(T=c.findPrev({currentElement:e,container:u,useActiveModalizer:!0}),T&&y){const e=Math.floor(T.getBoundingClientRect().right);!g&&e>D&&(T=void 0)}else!T&&E&&(T=c.findLast({container:u,useActiveModalizer:!0}));else if(t===b.Home)y?c.findElement({container:u,currentElement:e,useActiveModalizer:!0,isBackward:!0,acceptCondition:t=>{var s;if(!c.isFocusable(t))return!1;const i=Math.ceil(null!==(s=t.getBoundingClientRect().left)&&void 0!==s?s:0);return t!==e&&D<=i||(T=t,!1)}}):T=c.findFirst({container:u,useActiveModalizer:!0});else if(t===b.End)y?c.findElement({container:u,currentElement:e,useActiveModalizer:!0,acceptCondition:t=>{var s;if(!c.isFocusable(t))return!1;const i=Math.ceil(null!==(s=t.getBoundingClientRect().left)&&void 0!==s?s:0);return t!==e&&D>=i||(T=t,!1)}}):T=c.findLast({container:u,useActiveModalizer:!0});else if(t===b.PageUp){if(c.findElement({currentElement:e,container:u,useActiveModalizer:!0,isBackward:!0,acceptCondition:e=>!(!c.isFocusable(e)||X(this._win,e,a.visibilityTolerance)&&(T=e,1))}),y&&T){const e=Math.ceil(T.getBoundingClientRect().left);c.findElement({currentElement:T,container:u,useActiveModalizer:!0,acceptCondition:t=>{if(!c.isFocusable(t))return!1;const s=Math.ceil(t.getBoundingClientRect().left);return D<s||e>=s||(T=t,!1)}})}w=!1}else if(t===b.PageDown){if(c.findElement({currentElement:e,container:u,useActiveModalizer:!0,acceptCondition:e=>!(!c.isFocusable(e)||X(this._win,e,a.visibilityTolerance)&&(T=e,1))}),y&&T){const e=Math.ceil(T.getBoundingClientRect().left);c.findElement({currentElement:T,container:u,useActiveModalizer:!0,isBackward:!0,acceptCondition:t=>{if(!c.isFocusable(t))return!1;const s=Math.ceil(t.getBoundingClientRect().left);return D>s||e<=s||(T=t,!1)}})}w=!0}else if(y){const s=t===b.ArrowUp,i=D,o=Math.ceil(F.top),n=C,r=Math.floor(F.bottom);let l,a,d=0;c.findAll({container:u,currentElement:e,isBackward:s,onElement:e=>{const t=e.getBoundingClientRect(),u=Math.ceil(t.left),c=Math.ceil(t.top),h=Math.floor(t.right),_=Math.floor(t.bottom);if(s&&o<_||!s&&r>c)return!0;const m=Math.ceil(Math.min(n,h))-Math.floor(Math.max(i,u)),f=Math.ceil(Math.min(n-i,h-u));if(m>0&&f>=m){const t=m/f;t>d&&(l=e,d=t)}else if(0===d){const t=function(e,t,s,i,o,n,r,l){const a=s<o?o-s:r<e?e-r:0,u=i<n?n-i:l<t?t-l:0;return 0===a?u:0===u?a:Math.sqrt(a*a+u*u)}(i,o,n,r,u,c,h,_);(void 0===a||t<a)&&(a=t,l=e)}else if(d>0)return!1;return!0}}),T=l}return T&&(!s||s&&u.dispatchEvent(new x({by:"mover",owner:u,next:T,relatedEvent:s})))?(void 0!==w&&function(e,t,s){const i=Y(t);if(i){const o=$(e,i),n=t.getBoundingClientRect();i.scrollTop+=s?n.top-o.top:n.bottom-o.bottom}}(this._win,T,w),s&&(s.preventDefault(),s.stopImmediatePropagation()),n(T),T):null}async _isIgnoredInput(e,t){if("true"===e.getAttribute("aria-expanded")&&e.hasAttribute("aria-activedescendant"))return!0;if(ie(e,Be)){let s,i=0,o=0,n=0;if("INPUT"===e.tagName||"TEXTAREA"===e.tagName){const s=e.type,r=e.value;if(n=(r||"").length,"email"===s||"number"===s){if(n){const s=z.getSelection(e);if(s){const e=s.toString().length,i=t===Me||t===Ae;if(s.modify("extend",i?"backward":"forward","character"),e!==s.toString().length)return s.modify("extend",i?"forward":"backward","character"),!0;n=0}}}else{const t=e.selectionStart;if(null===t)return"hidden"===s;i=t||0,o=e.selectionEnd||0}}else"true"===e.contentEditable&&(s=new(oe(this._win))((t=>{this._ignoredInputResolve=e=>{delete this._ignoredInputResolve,t(e)};const s=this._win();this._ignoredInputTimer&&s.clearTimeout(this._ignoredInputTimer);const{anchorNode:r,focusNode:l,anchorOffset:a,focusOffset:u}=z.getSelection(e)||{};this._ignoredInputTimer=s.setTimeout((()=>{var t,s,c;delete this._ignoredInputTimer;const{anchorNode:d,focusNode:h,anchorOffset:_,focusOffset:m}=z.getSelection(e)||{};if(d===r&&h===l&&_===a&&m===u){if(i=_||0,o=m||0,n=(null===(s=e.textContent)||void 0===s?void 0:s.length)||0,d&&h&&z.nodeContains(e,d)&&z.nodeContains(e,h)&&d!==e){let t=!1;const s=e=>{if(e===d)t=!0;else if(e===h)return!0;const n=e.textContent;if(n&&!z.getFirstChild(e)){const e=n.length;t?h!==d&&(o+=e):(i+=e,o+=e)}let r=!1;for(let t=z.getFirstChild(e);t&&!r;t=t.nextSibling)r=s(t);return r};s(e)}null===(c=this._ignoredInputResolve)||void 0===c||c.call(this,!0)}else null===(t=this._ignoredInputResolve)||void 0===t||t.call(this,!1)}),0)})));if(s&&!(await s))return!0;if(i!==o)return!0;if(i>0&&(t===Me||t===Ae||t===Ne))return!0;if(i<n&&(t===Pe||t===xe||"End"===t))return!0}return!1}}
/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */
/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */
class Ve{constructor(e){this._isUncontrolledCompletely=e}isUncontrolledCompletely(e,t){var s;const i=null===(s=this._isUncontrolledCompletely)||void 0===s?void 0:s.call(this,e,t);return void 0===i?t:i}}
/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */class He{constructor(e){this.keyboardNavigation=e.keyboardNavigation,this.focusedElement=e.focusedElement,this.focusable=e.focusable,this.root=e.root,this.uncontrolled=e.uncontrolled,this.core=e}}class je{constructor(e,t){var s,i;this._forgetMemorizedElements=[],this._wrappers=new Set,this._initQueue=[],this._version="8.5.5",this._noop=!1,this.getWindow=()=>{if(!this._win)throw new Error("Using disposed Tabster.");return this._win},this._storage=function(e){const t=e.__tabsterInstanceContext;return new((null==t?void 0:t.basics.WeakMap)||WeakMap)}(e),this._win=e;const o=this.getWindow;(null==t?void 0:t.DOMAPI)&&function(e){for(const t of Object.keys(e))z[t]=e[t]}({...t.DOMAPI}),this.keyboardNavigation=new Se(o),this.focusedElement=new We(this,o),this.focusable=new Re(this),this.root=new ye(this,null==t?void 0:t.autoRoot),this.uncontrolled=new Ve((null==t?void 0:t.checkUncontrolledCompletely)||(null==t?void 0:t.checkUncontrolledTrappingFocus)),this.controlTab=null===(s=null==t?void 0:t.controlTab)||void 0===s||s,this.rootDummyInputs=!!(null==t?void 0:t.rootDummyInputs),this._dummyObserver=new ue(o),this.getParent=null!==(i=null==t?void 0:t.getParent)&&void 0!==i?i:z.getParentNode,this.internal={stopObserver:()=>{this._unobserve&&(this._unobserve(),delete this._unobserve)},resumeObserver:e=>{if(!this._unobserve){const t=o().document;this._unobserve=function(e,t,s,i){if("undefined"==typeof MutationObserver)return()=>{};const o=t.getWindow;let n;function r(t,s){n||(n=H(o).elementByUId),l(t,s);const i=J(e,t,(e=>l(e,s)));if(i)for(;i.nextNode(););}function l(e,i){var r;if(!e.getAttribute)return NodeFilter.FILTER_SKIP;const l=e.__tabsterElementUID;return l&&n&&(i?delete n[l]:null!==(r=n[l])&&void 0!==r||(n[l]=new Q(o,e))),(p(t,e)||e.hasAttribute(u))&&s(t,e,i),NodeFilter.FILTER_SKIP}const a=z.createMutationObserver((e=>{var i,o,n,l,a;const c=new Set;for(const d of e){const e=d.target,a=d.removedNodes,h=d.addedNodes;if("attributes"===d.type)d.attributeName===u&&(c.has(e)||s(t,e));else{for(let s=0;s<a.length;s++){const n=a[s];c.add(n),r(n,!0),null===(o=(i=t._dummyObserver).domChanged)||void 0===o||o.call(i,e)}for(let s=0;s<h.length;s++)r(h[s]),null===(l=(n=t._dummyObserver).domChanged)||void 0===l||l.call(n,e)}}c.clear(),null===(a=t.modalizer)||void 0===a||a.hiddenUpdate()}));return i&&r(o().document.body),a.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:[u]}),()=>{a.disconnect()}}(t,this,y,e)}}},q(o),this.queueInit((()=>{this.internal.resumeObserver(!0)}))}_mergeProps(e){var t;e&&(this.getParent=null!==(t=e.getParent)&&void 0!==t?t:this.getParent)}createTabster(e,t){const s=new He(this);return e||this._wrappers.add(s),this._mergeProps(t),s}disposeTabster(e,t){t?this._wrappers.clear():this._wrappers.delete(e),0===this._wrappers.size&&this.dispose()}dispose(){var e,t,s,i,o,n,r,l;this.internal.stopObserver();const a=this._win;null==a||a.clearTimeout(this._initTimer),delete this._initTimer,this._initQueue=[],this._forgetMemorizedElements=[],a&&this._forgetMemorizedTimer&&(a.clearTimeout(this._forgetMemorizedTimer),delete this._forgetMemorizedTimer),null===(e=this.outline)||void 0===e||e.dispose(),null===(t=this.crossOrigin)||void 0===t||t.dispose(),null===(s=this.deloser)||void 0===s||s.dispose(),null===(i=this.groupper)||void 0===i||i.dispose(),null===(o=this.mover)||void 0===o||o.dispose(),null===(n=this.modalizer)||void 0===n||n.dispose(),null===(r=this.observedElement)||void 0===r||r.dispose(),null===(l=this.restorer)||void 0===l||l.dispose(),this.keyboardNavigation.dispose(),this.focusable.dispose(),this.focusedElement.dispose(),this.root.dispose(),this._dummyObserver.dispose(),function(e){const t=H(e);t.fakeWeakRefsStarted=!1,t.fakeWeakRefsTimer&&(e().clearTimeout(t.fakeWeakRefsTimer),t.fakeWeakRefsTimer=void 0,t.fakeWeakRefs=[])}(this.getWindow),te(this.getWindow),this._storage=new WeakMap,this._wrappers.clear(),a&&(function(e){const t=e.__tabsterInstanceContext;t&&(t.elementByUId={},delete t.WeakRef,t.containerBoundingRectCache={},t.containerBoundingRectCacheTimer&&e.clearTimeout(t.containerBoundingRectCacheTimer),t.fakeWeakRefsTimer&&e.clearTimeout(t.fakeWeakRefsTimer),t.fakeWeakRefs=[],delete e.__tabsterInstanceContext)}(a),delete a.__tabsterInstance,delete this._win)}storageEntry(e,t){const s=this._storage;let i=s.get(e);return i?!1===t&&0===Object.keys(i).length&&s.delete(e):!0===t&&(i={},s.set(e,i)),i}forceCleanup(){this._win&&(this._forgetMemorizedElements.push(this._win.document.body),this._forgetMemorizedTimer||(this._forgetMemorizedTimer=this._win.setTimeout((()=>{delete this._forgetMemorizedTimer;for(let e=this._forgetMemorizedElements.shift();e;e=this._forgetMemorizedElements.shift())te(this.getWindow,e),We.forgetMemorized(this.focusedElement,e)}),0),G(this.getWindow,!0)))}queueInit(e){var t;this._win&&(this._initQueue.push(e),this._initTimer||(this._initTimer=null===(t=this._win)||void 0===t?void 0:t.setTimeout((()=>{delete this._initTimer,this.drainInitQueue()}),0)))}drainInitQueue(){if(!this._win)return;const e=this._initQueue;this._initQueue=[],e.forEach((e=>e()))}}function Qe(e,t){let s=Xe(e);return s?s.createTabster(!1,t):(s=new je(e,t),e.__tabsterInstance=s,s.createTabster())}function Ge(e){const t=Xe(e);return t?t.createTabster(!0):null}function qe(e){const t=e.core;return t.mover||(t.mover=new Ke(t,t.getWindow)),t.mover}function Je(e,t){const s=e.core;return s.deloser||(s.deloser=new ke(s,t)),s.deloser}function $e(e,t){e.core.disposeTabster(e,t)}function Xe(e){return e.__tabsterInstance}export{h as AsyncFocusSources,W as DeloserFocusLostEvent,F as DeloserFocusLostEventName,D as DeloserRestoreFocusEventName,m as DeloserStrategies,d as FOCUSABLE_SELECTOR,v as MoverDirections,b as MoverKeys,k as MoverMemorizedElementEventName,I as MoverMoveFocusEventName,L as MoverStateEvent,C as MoverStateEventName,_ as RestoreFocusOrders,B as RootBlurEvent,R as RootBlurEventName,S as RootFocusEvent,O as RootFocusEventName,g as SysDummyInputsPositions,u as TABSTER_ATTRIBUTE_NAME,c as TABSTER_DUMMY_INPUT_ATTRIBUTE_NAME,M as TabsterCustomEvent,A as TabsterFocusInEvent,E as TabsterFocusInEventName,P as TabsterFocusOutEvent,T as TabsterFocusOutEventName,x as TabsterMoveFocusEvent,w as TabsterMoveFocusEventName,f as Visibilities,Qe as createTabster,$e as disposeTabster,Je as getDeloser,me as getDummyInputContainer,qe as getMover,Ge as getTabster,fe as getTabsterAttribute,ve as mergeTabsterProps,be as setTabsterAttribute};
